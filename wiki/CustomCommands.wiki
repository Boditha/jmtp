#summary Sending custom commands directly to the Windows MTP-driver

= Introduction =

The Windows Portable Device API's allows sending custom commands directly to the driver. JMTP supports this functionality since beta 2. This is advanced functionality will (currently) only be supported on Windows.  

= Details =

To be able to send custom commands, the PortableDevice object must be cast to an PortableDeviceImplWin32 object. Then sendCommand method can be used. This method accepts a PropertyKey value and returns a PortableDeviceValuesImpl32 which are Java implementations of interfaces found in the Windows SDK (for more information about these classes, please read the information provided in the Windows SDK).

All the GUID’s and PropertyKey’s found in “PortableDeviceApi.h”, are defined in the java class jmtp.Win32WPDDefines. This allows easy use of all this values.

= Example =

{{{
PortableDeviceManager manager;
PortableDevice device;
PortableDeviceImplWin32 device32;
PortableDeviceValuesImplWin32 results;
COMException wpdError;
long driverError;
    	
manager = new PortableDeviceManager();
device = manager.getDevices()[0];
device.open();
    	
device32 = (PortableDeviceImplWin32)device;
try {
    results = device32.sendCommand(Win32WPDDefines.WPD_COMMAND_COMMON_RESET_DEVICE);
    		
    //check for success or failure to carry out the command
    try {
    	wpdError = results.getErrorValue(Win32WPDDefines.WPD_PROPERTY_COMMON_HRESULT);
    }
    catch(COMException e) {
    	//ignore exception if "ERROR_NOT_FOUND" -> item not in collection
    	if (e.getHresult() != Win32WPDDefines.ERROR_NOT_FOUND) {
    		System.out.println("Error: " + e.getErrorCode());
    	}
    }

    //check driver-specific error code
    try {
    	driverError = results.getUnsignedIntegerValue(Win32WPDDefines.WPD_PROPERTY_COMMON_DRIVER_ERROR_CODE);
    	System.out.println("Driver Error Code: " + driverError);
    }
    catch(COMException e) {
    	//ignore exception if "ERROR_NOT_FOUND" -> item not in collection
    	if (e.getHresult() != Win32WPDDefines.ERROR_NOT_FOUND) {
    		System.out.println("Error: " + e.getErrorCode());
    	}
    }
}
catch(COMException e) {
    System.out.println("Error: " + e.getErrorCode());
}
}}}